/*
 * This Java source file was generated by the Gradle 'init' task.
 */
/*package artificial_vision_tracking;

import org.bytedeco.javacv.CanvasFrame;
import org.bytedeco.javacv.FrameGrabber;
import org.bytedeco.javacv.OpenCVFrameConverter;
import org.bytedeco.javacv.OpenCVFrameGrabber;
import org.bytedeco.opencv.opencv_core.Mat;
import org.bytedeco.opencv.opencv_core.Rect;
import org.bytedeco.opencv.opencv_core.Scalar;
import org.bytedeco.opencv.global.opencv_imgproc;
import org.bytedeco.opencv.opencv_aruco.Board;
import org.bytedeco.javacv.Frame;
import org.bytedeco.opencv.opencv_objdetect.QRCodeDetector;
import org.bytedeco.javacpp.BytePointer;


public class App {
    public static void main(String[] args) throws FrameGrabber.Exception, InterruptedException {
        OpenCVFrameGrabber grabber = new OpenCVFrameGrabber(0);
        grabber.start();
        Board board = new Board();
        CanvasFrame canvas = new CanvasFrame("Webcam");
        canvas.setDefaultCloseOperation(javax.swing.JFrame.EXIT_ON_CLOSE);
        QRCodeDetector qrCodeDetector = new QRCodeDetector();
        OpenCVFrameConverter.ToMat converterToMat = new OpenCVFrameConverter.ToMat();

        while (canvas.isVisible() && (grabber.grab()) != null) {
            Frame frame = grabber.grab();


            Mat mat = converterToMat.convert(frame);
          
            Mat points = new Mat();
            BytePointer bytePointer = qrCodeDetector.detectAndDecode(mat); 
            //String decodedText = qrCodeDetector.detectAndDecode(mat).getString();
          
            if (bytePointer!=null && !bytePointer.toString().isEmpty()) {
                String decodedText = bytePointer.getString();
                System.out.println("QR Code detected: " + decodedText);
                for (int i = 0; i < points.size().height(); i++) {
                    Rect rect = new Rect(points.ptr(i));
                    opencv_imgproc.rectangle(mat, rect, new Scalar(0, 255, 0, 0));
                }
            }
          
            canvas.showImage(grabber.grab());
        }
        grabber.stop();
        grabber.close();
        canvas.dispose();
    }
}
*/



/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package artificial_vision_tracking;

import org.bytedeco.javacv.CanvasFrame;
import org.bytedeco.javacv.FrameGrabber;
import org.bytedeco.javacv.OpenCVFrameConverter;
import org.bytedeco.javacv.OpenCVFrameGrabber;
import org.bytedeco.opencv.opencv_core.Mat;
import org.bytedeco.opencv.opencv_core.MatVector;
import org.bytedeco.opencv.opencv_core.Point2fVectorVector;
import org.bytedeco.opencv.opencv_core.Rect;
import org.bytedeco.opencv.opencv_core.Scalar;
import org.bytedeco.opencv.global.opencv_aruco;
import org.bytedeco.opencv.global.opencv_imgproc;
import org.bytedeco.opencv.opencv_aruco.Board;
import org.bytedeco.javacv.Frame;
import org.bytedeco.opencv.opencv_objdetect.QRCodeDetector;
import org.bytedeco.javacpp.BytePointer;
import org.bytedeco.opencv.opencv_aruco.Dictionary;


public class App {
    public static void main(String[] args) throws FrameGrabber.Exception, InterruptedException {
        OpenCVFrameGrabber grabber = new OpenCVFrameGrabber(0);
        grabber.start();
        Board board = new Board();
        CanvasFrame canvas = new CanvasFrame("Webcam");
        canvas.setDefaultCloseOperation(javax.swing.JFrame.EXIT_ON_CLOSE);
        OpenCVFrameConverter.ToMat converterToMat = new OpenCVFrameConverter.ToMat();
        
        //Aruco tag Detection
        Dictionary dictionary = opencv_aruco.getPredefinedDictionary(opencv_aruco.DICT_6X6_250);

        while (canvas.isVisible() && (grabber.grab()) != null) {
            Frame frame = grabber.grab();
            Mat mat = converterToMat.convert(frame);

            // Lista di vettori di punti per i marker rilevati
            MatVector markerCorners = new MatVector();
            //Point2fVectorVector markerCorners = new Point2fVectorVector();
            Mat markerIds = new Mat();

            opencv_aruco.detectMarkers(mat, dictionary, markerCorners, markerIds);

            // Se sono stati rilevati marker, disegna i contorni
            if (markerIds.size().height() > 0) {
                opencv_aruco.drawDetectedMarkers(mat, markerCorners, markerIds, new Scalar(0, 255, 0, 0));
            }

            canvas.showImage(converterToMat.convert(mat));
          
            /*
            if (bytePointer!=null && !bytePointer.toString().isEmpty()) {
                String decodedText = bytePointer.getString();
                System.out.println("QR Code detected: " + decodedText);
                for (int i = 0; i < points.size().height(); i++) {
                    Rect rect = new Rect(points.ptr(i));
                    opencv_imgproc.rectangle(mat, rect, new Scalar(0, 255, 0, 0));
                }
            }
          
            canvas.showImage(grabber.grab());
            */
        }
        grabber.stop();
        grabber.close();
        dictionary.close();
        canvas.dispose();
    }
}